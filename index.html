<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Tour 360° Casa M2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body, html { margin:0; padding:0; height:100%; overflow:hidden; background:#000; font-family:Arial,sans-serif; }
        #panorama { width:100%; height:100%; }
        
        /* Desplegable tipo Sketchfab - esquina inferior centro */
        .scene-selector {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            border-radius: 8px;
            padding: 8px 12px;
            color: white;
            z-index: 1000;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        .scene-selector button {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0 10px;
        }
        .scene-selector select {
            background: rgba(255,255,255,0.15);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 15px;
            cursor: pointer;
        }
        .scene-selector select option { background:#222; }
    </style>
    <link rel="stylesheet" href="https://cdn.pannellum.org/2.5/pannellum.css"/>
    <script src="https://cdn.pannellum.org/2.5/pannellum.js"></script>
</head>
<body>
    <div id="panorama"></div>

    <!-- Selector elegante estilo Sketchfab -->
    <div class="scene-selector">
        <button onclick="prevScene()" title="Anterior">←</button>
        <select id="sceneSelect" onchange="loadScene(this.value)"></select>
        <button onclick="nextScene()" title="Siguiente">→</button>
    </div>

    <script>
        const scenes = {
            living:   { title: "1. Living / Comedor",      panorama: "https://raw.githubusercontent.com/jomviz/panoramas360/main/m2-1.jpg" },
            cocina:   { title: "2. Cocina",               panorama: "https://raw.githubusercontent.com/jomviz/panoramas360/main/m2-2.jpg" },
            dormi1:   { title: "3. Dormitorio Principal", panorama: "https://raw.githubusercontent.com/jomviz/panoramas360/main/m2-3.jpg" },
            dormi2:   { title: "4. Dormitorio 2",         panorama: "https://raw.githubusercontent.com/jomviz/panoramas360/main/m2-4.jpg" },
            baño:     { title: "5. Baño",                 panorama: "https://raw.githubusercontent.com/jomviz/panoramas360/main/m2-5.jpg" },
            patio:    { title: "6. Patio / Quincho",      panorama: "https://raw.githubusercontent.com/jomviz/panoramas360/main/m2-6.jpg" }
        };

        let currentScene = 'living';
        let viewer = null;

        // Carga escena + hotspots
        function loadScene(id) {
            currentScene = id;
            const base = {
                default: { firstScene: id, sceneFadeDuration: 800, autoLoad: true },
                scenes: {}
            };
            // Copia todas las escenas con sus hotspots
            Object.keys(scenes).forEach(key => {
                base.scenes[key] = {
                    title: scenes[key].title,
                    type: "equirectangular",
                    panorama: scenes[key].panorama,
                    hotSpots: []
                };
                // Hotspots personalizados (ajustalos cuando lo veas en vivo)
                if (key === "living") {
                    base.scenes[key].hotSpots = [
                        { pitch: 5,   yaw: 30,   type: "scene", text: "Cocina",      sceneId: "cocina" },
                        { pitch: -5,  yaw: -110, type: "scene", text: "Dormitorio 1", sceneId: "dormi1" },
                        { pitch: -10, yaw: 170,  type: "scene", text: "Patio",       sceneId: "patio" }
                    ];
                }
                if (key === "cocina")   base.scenes[key].hotSpots.push({ pitch: 0, yaw: 180, type: "scene", text: "Living", sceneId: "living" });
                if (key === "dormi1")   base.scenes[key].hotSpots.push({ pitch: 0, yaw: -90, type: "scene", text: "Living", sceneId: "living" });
                if (key === "dormi2")   base.scenes[key].hotSpots.push({ pitch: 0, yaw: 180, type: "scene", text: "Living", sceneId: "living" });
                if (key === "baño")     base.scenes[key].hotSpots.push({ pitch: 0, yaw: -90, type: "scene", text: "Dormitorio 1", sceneId: "dormi1" });
                if (key === "patio")    base.scenes[key].hotSpots.push({ pitch: -5, yaw: 10, type: "scene", text: "Living", sceneId: "living" });
            });

            if (viewer) viewer.destroy();
            viewer = pannellum.viewer('panorama', base);
            document.getElementById('sceneSelect').value = id;
        }

        // Navegación con flechas
        function nextScene() {
            const order = Object.keys(scenes);
            const idx = order.indexOf(currentScene);
            loadScene(order[(idx + 1) % order.length]);
        }
        function prevScene() {
            const order = Object.keys(scenes);
            const idx = order.indexOf(currentScene);
            loadScene(order[(idx - 1 + order.length) % order.length]);
        }

        // Llena el <select>
        window.onload = function() {
            const select = document.getElementById('sceneSelect');
            Object.keys(scenes).forEach(id => {
                const opt = document.createElement('option');
                opt.value = id;
                opt.textContent = scenes[id].title;
                select.appendChild(opt);
            });
            loadScene('living');
        };
    </script>
</body>
</html>
